\chapter{Propuesta de Solución}

En este cap\'itulo se presenta una posible soluci\'on al problema de generar un horario universitario de clases de forma autom\'atica, para ello se modelar\'a como un Problema de Satisfacci\'on de Restricciones. Del Sistema de Gesti\'on de Horarios se explicar\'a la modelaci\'on de la entidades involucradas, la funci\'on de felicidad del sistema y un API para interactuar con el mismo. Luego se mostrar\'a c\'omo se definieron las variables y los dominios de valores de las mismas, las restricciones del problema y la estructura del grafo de restricciones. Por \'ultimo se examinar\'an los algoritmos y t\'ecnicas utilizadas para darle soluci\'on al problema.

\section{Interacci\'on con el Sistema de Gesti\'on de Horarios}

Como ya se hab\'ia mencionado este trabajo formar\'a parte de un Sistema de Gesti\'on de Horarios desarrollado por el profesor Lic. Pedro Quintero Rojas perteneciente a la facultad de Matem\'atica y Computaci\'on de la Universidad de La Habana. Dicho sistema consiste en un sitio web implementado en Ruby on Rails. La versi\'on del int\'erprete de Ruby utilizado fue 1.9 y la versi\'on de Rails fue 3.2.13, para la base de datos se utiliz\'o SQLite3.

El sistema contiene toda la informaci\'on necesaria para generar un horario de clases. Tambi\'en muestra una vista actualizada del horario vigente y las personas autorizadas pueden modificar turnos planificados y reservar aulas de manera transparente. En un futuro se desea implementar una herramienta para tel\'efonos celulares donde se pueda interactuar con el sistema y de alguna forma avisar a las personas involucradas cuando se cambie un turno de clase. 

\subsection{Modelaci\'on de las entidades involucradas}

Para generar un horario de clases de un semestre para una facultad es necesario tener de antemano toda la informaci\'on referente. Se necesita conocer:

\begin{itemize}

\item Las carreras que se estudian en la facultad.
\item Los años docentes que tiene cada carrera.
\item Cantidad de grupos por año docente.
\item Por cada año docente conocer las asignaturas que se deben dar en el semestre en cuesti\'on.
\item Por cada semana del semestre conocer la cantidad y el tipo de turno que se deben impartir de cada asignatura.
\item Los profesores que imparten cada asignatura.
\item Capacidad y tipo de locales disponibles de la facultad.

\end{itemize}

Para cada entidad antes mencionada existe una tabla en la base de datos del sistema. Algunas de las tablas son: \emph{faculties, careers, years, groups, subjects, semesters, professors, locals}. Por ejemplo toda carrera pertenece a una facultad, cada grupo pertenece a un año que a su vez pertenece a una carrera y cada asignatura pertenece a un semestre y a un año.

La tabla \emph{partitions} se utiliza para conocer dado una semana la cantidad y el tipo de turnos que se deben impartir de una asignatura. Generalmente en cada semana se debe impartir una conferencia y una clase pr\'actica de cada asignatura perteneciente al semestre, pero esto no siempre sucede as\'i, existen asignaturas que cambian su planificaci\'on en dependencia si la semana es par o impar. Por otro lado, la tabla \emph{distributions} dado un grupo y una asignatura especifica el profesor que le debe impartir dicha asignatura al grupo dado.

\subsection{Funci\'on de felicidad del sistema}

El Sistema de Gesti\'on de Horarios tiene un m\'odulo dedicado a la especificaci\'on de restricciones. En \'el cada profesor puede especificar sus condiciones o preferencias. Una gran variedad de restricciones pueden ser modeladas, por ejemplo, que un profesor prefiera que todos sus turnos de clases sean en un aula determinada o en un d\'ia espec\'ifico de la semana, que los turnos de conferencia sean en los primeros dias de la semana o que dos turnos de conferencia de una asignatura sean en turnos consecutivos.

Cada profesor puede definir varias restricciones y a cada una de ellas le puede asociar una prioridad. Pueden existir restricciones a las que el profesor le gustar\'ia que se tomaran en cuenta y pueden exitir otras restricciones que tengan una importacia de primer orden para \'el, por ejemplo la imposibilidad de impartir clases un determinado d\'ia de la semana, a estas \'ultimas restricciones el profesor debe darles una prioridad alta.

El sistema define la felicidad de un profesor como el grado de cumplimiento de sus restricciones en el horario actual. Dicha medida es calculada por la siguiente funci\'on:

\[ f_{p} = \frac{\sum\limits_{i=1}^n w_{ip} c_{ip}}{\sum\limits_{i=1}^n w_{ip}} \]

\begin{description}

\item[$w_{ip} \in \{1 \ldots 100\}$]: prioridad de la restricci\'on \emph{i} del profesor \emph{p}
\item[$c_{ip} \in \lbrack 0,1 \rbrack$]: grado de cumplimiento de la restricci\'on \emph{i} del profesor \emph{p}
\item[$n$]: cantidad de restricciones definidas por el profesor \emph{p}
\item[$f_{p} \in \lbrack 0,1 \rbrack$]: felicidad del profesor \emph{p}

\end{description}

Tambi\'en se define la felicidad del sistema o el grado de cumplimiento de todas las restricciones impuestas por los profesores. Cada profesor tiene asociada una prioridad en dependencia de su categor\'ia cient\'ifica o docente, adem\'as se tiene en cuenta el cargo que ocupa dentro de la facultad. La felicidad del sistema se calcula de la siguiente forma:

\[ F = \frac{\sum\limits_{i=1}^m f_{i} p_{i}}{\sum\limits_{i=1}^m p_{i}} \]

\begin{description}

\item[$f_{i} \in \lbrack 0,1 \rbrack$]: felicidad del profesor \emph{i}
\item[$p_{i} \in \{1 \ldots 100\}$]: prioridad del profesor \emph{i}
\item[$m$]: cantidad de profesores
\item[$F \in \lbrack 0,1 \rbrack$]: felicidad general del sistema

\end{description}

Debe aclararse que no es el sistema quien decide la forma en la que se toman las decisiones al respecto de los horarios, ni si éstos son confeccionados democrática o dictatorialmente. Esto se decide cuando se asignan las prioridades de los profesores, proceso que se sale de los objetivos de este trabajo. Si se quiere un mecanismo extremadamente democrático, basta con dar a todos la misma prioridad. Un sistema extremadamente dictatorial se lograría dando la misma prioridad a todos los usuarios salvo a uno de ellos, al que se le asignaría una prioridad superior al resto.

\subsection{API de interacci\'on con el Sistema de Gesti\'on de Horarios}

esperando por Gabriel...

\section{Modelaci\'on como un CSP}

\subsection{Variables y sus dominios de valores}

\subsection{Restricciones}

\subsection{Estructura del grafo de restricciones}

\section{Algoritmos y t\'ecnicas implementadas}

\subsection{Backtracking Recursive}

\subsection{Minimum Remaining Values}

\subsection{Forward Checking}

\subsection{Arc Consistency}

\subsection{B\'usqueda Local con Min-Conflicts}